<?xml version="1.0" encoding="UTF-8"?>
<project default="compile" name="semparse">
  <!-- Set useful variables -->
  <property name="target" value="1.8"/>
  <property name="source" value="1.8"/>
  <property name="root" value="."/>
  <property name="src" location="${root}/src/"/>
  <property name="classes" location="${root}/classes"/>
  <property name="lib" location="${root}/lib"/>
  <property name="libsempre" location="${root}/libsempre"/>
  <path id="lib.path">
    <fileset dir="${libsempre}" includes="*.jar"/>
    <fileset dir="${lib}" includes="*.jar"/>
  </path>

  <!-- Create directories -->
  <target name="init">
    <exec executable="${root}/scripts/extract-module-classes.rb"/>
    <mkdir dir="${classes}"/>
    <mkdir dir="${libsempre}"/>
  </target>

  <!-- Compile -->
  <target name="compile" depends="init">
    <antcall target="compile.released"/>
  </target>

  <!-- Compile core -->
  <target name="core" depends="init">
    <echo message="Compiling ${ant.project.name}: core"/>
    <mkdir dir="${classes}"/>
    <javac srcdir="${src}" destdir="${classes}" classpathref="lib.path" debug="true" includeantruntime="false" source="${source}" target="${target}">
      <include name="edu/stanford/nlp/sempre/*.java"/>
      <include name="edu/stanford/nlp/sempre/test/"/>
    </javac>
    <jar destfile="${libsempre}/sempre-core.jar" basedir="${classes}" includes="edu/**"/>
  </target>

  <!-- Compile cache -->
  <target name="cache" depends="init">
    <echo message="Compiling ${ant.project.name}: cache"/>
    <mkdir dir="${classes}/cache"/>
    <javac srcdir="${src}" destdir="${classes}/cache" classpathref="lib.path" debug="true" includeantruntime="false" source="${source}" target="${target}">
      <include name="edu/stanford/nlp/sempre/cache/"/>
    </javac>
    <jar destfile="${libsempre}/sempre-cache.jar" basedir="${classes}/cache"/>
  </target>

  <!-- Compile corenlp -->
  <target name="corenlp" depends="init,core">
    <echo message="Compiling ${ant.project.name}: corenlp"/>
    <mkdir dir="${classes}/corenlp"/>
    <javac srcdir="${src}" destdir="${classes}/corenlp" classpathref="lib.path" debug="true" includeantruntime="false" source="${source}" target="${target}">
      <include name="edu/stanford/nlp/sempre/corenlp/"/>
    </javac>
    <jar destfile="${libsempre}/sempre-corenlp.jar" basedir="${classes}/corenlp"/>
  </target>

  <!-- Compile overnight -->
  <target name="overnight" depends="init,core">
    <echo message="Compiling ${ant.project.name}: overnight"/>
    <mkdir dir="${classes}/overnight"/>
    <javac srcdir="${src}" destdir="${classes}/overnight" classpathref="lib.path" debug="true" includeantruntime="false" source="${source}" target="${target}">
      <include name="edu/stanford/nlp/sempre/overnight/"/>
    </javac>
    <jar destfile="${libsempre}/sempre-overnight.jar" basedir="${classes}/overnight"/>
  </target>

  <!-- Compile thingtalk -->
  <target name="thingtalk" depends="init,core,corenlp,overnight">
    <echo message="Compiling ${ant.project.name}: thingtalk"/>
    <mkdir dir="${classes}/thingtalk"/>
    <javac srcdir="${src}" destdir="${classes}/thingtalk" classpathref="lib.path" debug="true" includeantruntime="false" source="${source}" target="${target}">
      <include name="edu/stanford/nlp/sempre/thingtalk/"/>
    </javac>
    <jar destfile="${libsempre}/sempre-thingtalk.jar" basedir="${classes}/thingtalk"/>
  </target>

  <!-- Compile api -->
  <target name="api" depends="init,core,thingtalk">
    <echo message="Compiling ${ant.project.name}: api"/>
    <mkdir dir="${classes}/api"/>
    <javac srcdir="${src}" destdir="${classes}/api" classpathref="lib.path" debug="true" includeantruntime="false" source="${source}" target="${target}">
      <include name="edu/stanford/nlp/sempre/api/"/>
    </javac>
    <jar destfile="${libsempre}/sempre-api.jar" basedir="${classes}/api"/>
  </target>

  <!-- Clean up -->
  <target name="clean">
    <delete includeemptydirs="true" quiet="true">
      <fileset dir="${classes}" followsymlinks="false"/>
      <fileset dir="${libsempre}" followsymlinks="false"/>
      <fileset file="module-classes.txt" followsymlinks="false"/>
    </delete>
  </target>

</project>
